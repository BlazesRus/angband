# File: Makefile.emx

# Purpose: Makefile support for "main-emx.c"

# Note: Use 'dmake -B -r -f makefile.emx' to compile (see "main-emx.c" for details).
#       Since "dmake" does not demand "hard" tab stops as delimiters,
#       don't bother to add them.
#
# Note: Use 'dmake -B -r -f makefile.emx install' to install the executables
#       plus the batch file used for multiple windows in the parent directory.
#
# Note: use 'dmake -B -r -f makefile.emx clean' to remove temporary files.

OBJS = \
  main.o main-emx.o wizard.o wiz-spo.o \
  borg.o borg-ben.o borg-ext.o borg-map.o borg-obj.o borg-aux.o \
  signals.o util.o io.o init.o save.o save-old.o files.o \
  generate.o birth.o melee.o dungeon.o store.o \
  effects.o cmd1.o cmd2.o cmd3.o cmd4.o cmd5.o cmd6.o \
  misc.o monster.o mon-desc.o object.o obj-desc.o \
  spells1.o spells2.o cave.o tables.o variable.o \
  term.o z-util.o z-virt.o z-form.o 

CC = gcc
CFLAGS = -MMD -O2 -DUSE_EMX -g -Wall
LIBS = -lvideo

.c.o:
    $(CC) $(CFLAGS) -c $*.c

default: angband.exe aclient.exe dependencies

install: ..\angband.exe ..\aclient.exe ..\startwnd.cmd
    emxbind -s ..\angband.exe
    emxbind -s ..\aclient.exe

clean:
    + del *.d
    + del dependencies

dependencies .IGNORE: $(OBJS)
    + echo. > dependencies
    + for %a in (*.d) type %a >> dependencies

..\angband.exe: angband.exe
    + copy angband.exe ..

..\aclient.exe: aclient.exe
    + copy aclient.exe ..

EC=+@ echo 
ECF=>> ..\startwnd.cmd

..\startwnd.cmd: makefile.emx
 $(EC) @echo off                                             > ..\startwnd.cmd
 $(EC) REM This file starts up Angband and up to three other views. The $(ECF)
 $(EC) REM optional number behind the name sets the number of lines for $(ECF)
 $(EC) REM that screen.                                                 $(ECF)
 $(EC) REM                                                              $(ECF)
 $(EC) REM Note the function of the three views:                        $(ECF)
 $(EC) REM                                                              $(ECF)
 $(EC) REM   recall window - display monster recall info                $(ECF)
 $(EC) REM   choice window - display equipment and inventory            $(ECF)
 $(EC) REM   mirror window - display both of them as new information    $(ECF)
 $(EC) REM                   pops up - use this if you've got a small   $(ECF)
 $(EC) REM                   screen that doesn't comfortably allow for  $(ECF)
 $(EC) REM                   three windows.                             $(ECF)
 $(EC).                                                                 $(ECF)
 $(EC) start /win /n aclient recall 10                                  $(ECF)
 $(EC) start /win /n aclient choice                                     $(ECF)
 $(EC) rem start /win /n aclient mirror                                 $(ECF)
 $(EC) delay                                                            $(ECF)
 $(EC) angband %1 %2 %3 %4 %5 %6 %7 %8 %9                               $(ECF)

angband.exe: $(OBJS)
    $(CC) $(CFLAGS)  -o angband.exe $(OBJS) $(LIBS)

aclient.exe: main-emx.c
    $(CC) $(CFLAGS) -D__EMX__ -D__EMX__CLIENT__ -o aclient.exe main-emx.c $(LIBS)

.INCLUDE .IGNORE: dependencies
